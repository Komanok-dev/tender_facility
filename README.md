# Tender Management API

API для управления тендерами и предложениями.

## Оглавление

- [Описание](#описание)
- [Требования](#требования)
- [Настройка окружения](#настройка-окружения)
- [Запуск приложения](#запуск-приложения)
- [Тестирование](#тестирование)
- [Использование API](#использование-api)

## Описание

Это API для управления тендерами и предложениями, реализованное с использованием FastAPI и PostgreSQL. Оно включает в себя функционал для создания, редактирования и просмотра тендеров и предложений, а также работы с отзывами.

## Требования

- Docker
- Docker Compose
- Python 3.12 (если планируется запуск без Docker)

## Настройка окружения

Перед запуском убедитесь, что у вас есть необходимые переменные окружения. Создайте файл `.env` в корневой директории и добавьте следующие параметры:

```bash
SERVER_ADDRESS=0.0.0.0:8080
POSTGRES_CONN=postgresql://postgres:postgres@db:5432/postgres
POSTGRES_USERNAME=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=db
POSTGRES_PORT=5432
POSTGRES_DATABASE=postgres
```

## Запуск приложения

### 1. Запуск через Docker

Для запуска приложения с использованием Docker выполните следующие шаги:

1. Убедитесь, что в корне проекта у вас есть файл `.env` с корректными параметрами подключения к базе данных.
2. Откройте терминал и выполните команду для сборки и запуска контейнеров с помощью Docker Compose:

   ```bash
   docker-compose up --build
   ```

### 2. Локальный запуск без Docker

Для локального запуска приложения выполните следующие шаги:


1. Установите зависимости через Poetry, если он у вас еще не установлен:

   ```bash
   poetry install
   ```

2. Убедитесь, что у вас запущен сервер PostgreSQL, и он настроен согласно переменным в файле .env:

```bash
SERVER_ADDRESS=0.0.0.0:8080
POSTGRES_CONN=postgresql://postgres:postgres@localhost:5432/postgres
POSTGRES_USERNAME=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DATABASE=postgres
```

3. Запустите FastAPI сервер локально:

   ```bash
   poetry run uvicorn backend.main:app --host 0.0.0.0 --port 8080 --reload
   ```

После этого приложение будет доступно по адресу http://localhost:8080/api

## Тестирование

### 1. Для запуска тестирования через Docker

Выполните команду:
   ```bash
   docker compose run test
   ```

### 2. Для запуска локального тестирования без Docker

Выполните команду:
   ```bash
   pytest
   ```

Все тесты находятся в папке tests/, и они включают тестирование всех ключевых функций API, таких как создание тендера, добавление предложений и отзывов.

## Использование API

После запуска приложения, у вас будет доступ к следующим ключевым эндпоинтам:

### 1. Проверка состояния сервера:
GET /api/ping

Этот эндпоинт проверяет готовность сервера принимать запросы. Ответ будет "ok", если сервер работает.

### 2. Работа с тендерами:
```
GET /api/tenders
```

Получение списка всех тендеров с возможностью фильтрации по типу услуг.

```
POST /api/tenders/new
```

Создание нового тендера с параметрами, такими как название, описание и тип услуги.

```
PATCH /api/tenders/{tenderId}/edit
```

Редактирование существующего тендера по его уникальному идентификатору.

```
PUT /api/tenders/{tenderId}/rollback/{version}
```

Откат версии тендера к предыдущему состоянию с инкрементированием версии.


### 3. Работа с предложениями:

```
POST /api/bids/new
```

Создание нового предложения для существующего тендера. Необходимо указать описание и цену.

```
PATCH /api/bids/{bidId}/edit
```

Редактирование существующего предложения по его уникальному идентификатору.

```
PUT /api/bids/{bidId}/rollback/{version}
```

Откат версии предложения к предыдущей версии.

### 4. Работа с отзывами:

```
GET /api/bids/{tenderId}/reviews
```

Получение списка отзывов на предложения, связанные с указанным тендером. Авторизация обязательна.

Документация API:
Для полной документации API с примерами запросов и ответов, перейдите по адресу http://localhost:8080/docs (документация в формате Swagger).# tender_facility
